"use strict";function checkSupport(){var e="MozWebSocket"in window?"MozWebSocket":"WebSocket"in window?"WebSocket":null;return null===e?(Materialize.toast("Your browser doesn't support Websockets! You won't be able to use this service...",1e6,"warning-toast"),!1):!0}function checkNotify(){window.Notification&&Notify.needsPermission&&Notify.requestPermission()}function notifyEmail(e){var s=new Notify(e.from,{icon:"/img/ios-desktop.png",body:e.body,timeout:4});s.show()}function showRaw(e){$("#rawArea").text(messages[e].raw),$("#rawModal").openModal()}function getAttachments(e){if(0===messages[e].attachments.length)return"No Attachments";var s=messages[e].attachments.length+" attachment";messages[e].attachments.length>1&&(s+="s"),s+=": ";var t=messages[e].attachments.map(function(e){var s="data:"+e.type+";"+e.transferEncoding+","+e.data;return'<a href="'+s+'" target="_blank">'+e.name+"</a>"}).join(", "),a=s+t;return a}function processDisconnect(e){Materialize.toast("Server connection lost - please refresh",1e6,"warning-toast")}function processMessage(e){if(!addressLoaded){var s=JSON.parse(e.data);return $("#serverAddress").html(host),$("#mailAddress").html(s[0]),$("#serverPort").html(s[1]),$("#dropSize").html(s[2]/1e3),$("#copyLink").attr("data-clipboard-text",s[0]),void(addressLoaded=!0)}var t=JSON.parse(e.data);messages.push(t);var a=messages.length-1;null===t.body&&(t.body="[no body]",messages.pop(),messages.push(t),a=messages.length-1);var o='<li class="collection-item avatar"><i class="material-icons circle">mail</i><span class="title"><strong>'+escapeHtml(t.subject)+"</strong></span><p>"+escapeHtml(t.from)+" (at "+escapeHtml(t.fromIP[0])+")<br>"+(new Date).toLocaleString()+"<br>"+getAttachments(a)+'</p><a href="#!" onClick="showRaw('+a+');" class="secondary-content" title="View Raw Message"><i class="material-icons">code</i></a><div class="inlineCode">'+escapeHtml(t.body).replace(/(?:\r\n|\r|\n)/g,"<br />")+"</div></li>";$("#noMessages").hide(),$("#messageCollection").prepend(o),notifyEmail(t)}var host=window.location.hostname,messages=[],addressLoaded=!1;if(window.onbeforeunload=function(e){return messages.length>0?"You will lose access to the contents of this Mockbox and be unable to use this address again.":void 0},checkSupport()){var mailSocket=new WebSocket("ws://"+host+":9000");mailSocket.onmessage=processMessage,mailSocket.onclose=processDisconnect;var clipboard=new Clipboard("#copyLink");checkNotify()}