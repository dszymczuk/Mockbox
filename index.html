<!doctype html>
<html>

<head>
  <title>Mockbox.io</title>
</head>

<body>

</body>
<script>
 /* jshint -W060 */
  var support = "MozWebSocket" in window ? 'MozWebSocket' : ("WebSocket" in window ? 'WebSocket' : null);
  if (support === null) {
    alert("Your browser doesn't support Websockets.");
  }

  var mailSocket = new WebSocket("ws://localhost:9000");

  var isFirstMessage = true;
  mailSocket.onmessage = processMessage;
  mailSocket.onclose = processDisconnect;

  function processMessage(event) {
    if (isFirstMessage) {
      document.write('<h2>Send messages to ' + event.data + '</h2>');
      document.write('<h4>SMTP server at localhost:25 (no/any authentication accepted - server, port, and recipient are all that matter)</h4><hr>');
      isFirstMessage = false;
    } else {
      var mailObj = JSON.parse(event.data);
      console.log(event.data);
      document.write('<hr><strong>From:</strong>' + mailObj.from);
      document.write('<br><strong>Subject:</strong>' + mailObj.subject);
      document.write('<br><strong>IP:</strong>' + mailObj.fromIP[0]);
      document.write('<br><strong>Attachments:</strong>' + mailObj.attachments.length);
    }
  };

  function processDisconnect(event) {
    alert("server has gone away; please refresh");
  }
</script>

</html>
